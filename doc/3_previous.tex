\chapter{Previous Scheme}\markright{Previous Scheme}\label{sec:previous_scheme}
\section{Overview of the previous scheme} 
In order to deal with spreading IoT malwares with device-side detections in more practical means, CNN is utilized in the previous scheme \cite{previous}.
Our research is more practical scheme which applys this device-side detection with CNN improving its issues.
The main idea of the previous scheme is that there exists the difference of GSIs converted from each malware Binary Data (BD) which is always acquired in IoT devices due to the exectable format of them.
In that scheme \cite{previous}, a malware binary is reformatted as an 8-bit sequence and then be converted to a GSI which has one channel and pixel values from 0 to 255.
To confirm the performance of the scheme, some samples of malware and benign software GSIs are prepared in our research and shown by \figurename~\ref{fig:malGSI} and \figurename~\ref{fig:benGSI}.
By comparison, some novel differences between them can be observed even by human eyes.
For example, it can be seen that malware GSIs always are more dense.
On the other hand, the GSI of benign softwares tend to have larger header parts than malwares.

These GSIs can represents each features and be fed into CNN.
Since, CNN can extract effective features from these GSI automatically by learning deep non-linear features even that can be hardly descovered and understood by human eyes.
Furthermore, once trained, the network itself is lightweight and can be run with tiny computational resources, since only the trained parameters and information of network structure are kept.
Thus, CNN is a suitable scheme for IoT malware detections since it does not demand feature engineering and also computational costs while the detection.

\begin{figure}[h]
 \centering
 %\hspace{-55pt}
 \includegraphics[scale=0.5]{./figures/malGSI.pdf}
 \caption{The malware GSIs.} 
 \label{fig:malGSI}
\end{figure}
%\afterpage{\clearpage}
%\newpage
\begin{figure}[h]
 \centering
 %\hspace{-55pt}
 \includegraphics[scale=0.5]{./figures/benGSI.pdf}
 \caption{The benign file GSIs.} 
 \label{fig:benGSI}
\end{figure}
%\afterpage{\clearpage}
%\newpage

\section{Issues of the previous scheme } 
Although the previous scheme can cope with spreading IoT malwares with device-side detection in more practical means, it is susceptible to evasive techniques against the inputs of the CNN, GSIs and binary \cite{attack1, attack2}.
Adversaries can evade the CNN based detection with two evasive techniques against each input as shown in \figurename~\ref{fig:ov}.
Malwares whose GSIs are manipulated to evade the detection are called Adversarial Malware (AM) and also malwares whose binary is manipulated are called Obfuscated Malware (OM) in this research.  
The representative vulnerabilities against each attack are explained in the following subsections.

\begin{figure}[h]
 \centering
 %\hspace{-55pt}
 \includegraphics[scale=0.5]{./figures/overview.pdf}
 \caption{The overview of evasive techniques.} 
 \label{fig:ov}
\end{figure}
%\afterpage{\clearpage}
\newpage

\subsection{Vulnerability against GSI manipulation}
The GSIs fed into the network as inputs in the previous scheme have pixels that match the Binary Data (BD), which is inserted into the source code by the compiler and has nothing to do with runtime behaviour \cite{am}.
Adversaries can make the CNN model cause false judge as benign by intentionally applying some noises to these pixel values \cite{am}.
The two GSIs shown in \figurename~\ref{fig:amGSI} are the actual GSIs of a malware before and after adding noise.
The noise is added to the GSI of AM by manipulating the pixel values of pixel that match metadata or debugging information which is irrelevant to the runtime behaviour.
By adding the noise in this way, the AM can mislead CNN as benign in the previous scheme.
The AM attack is a threat to CNN detection since it allows the classifier to intentionally judge the malware as benign while maintaining the original behaviour of malware.

\begin{figure}[h]
 \centering
 %\hspace{-55pt}
 \includegraphics[scale=0.5]{./figures/AM.pdf}
 \caption{The AM GSIs.} 
 \label{fig:amGSI}
\end{figure}
%\afterpage{\clearpage}
\newpage
\subsection{Vulnerability against binary manipulation}
The binary which converts to a GSI can also be manipulated to evade the CNN detection by being obfuscated \cite{om}.
Due to the small computational resources, obfuscation techniques with packing tools, which also can compress the BD while encrypting, are tend to be used in IoT malware obfuscation field.
As shown in \figurename~\ref{fig:omGSI}, the original BD is compressed and encrypted at the same time, and new headers and tool-dependent data which do not contribute to the decision for detection are inserted.
In addition to the fact that malware obfuscated with the packing tools can be recovered and analyzed only at runtime, the encryption method differs depending on the packing tool.Thus, binary manipulation attack is a threat especially for IoT devices which are not suitable for dynamic analysis due to the limited computing resources since there is no way to statically analyze them in advance.

\begin{figure}[h]
 \centering
 %\hspace{-55pt}
 \includegraphics[scale=0.5]{./figures/OM.pdf}
 \caption{The OM GSIs.} 
 \label{fig:omGSI}
\end{figure}
\newpage


\paragraph*{}
While previous scheme based on CNN can achieve high accuracy in detection, it is vulnerable against the above two attacks which aim to evade detection resulting in lower detection accuracy.
In fact, \tablename~\ref{tab:prev} shows the original accuracy and the degradation of them by each attack.
The accuracy, which achieves 99.8\%, drops to 66.1\% under the AM attack with GSI manipulation and 86.2\% under the OM attack with BD manipulation.
The results indicate that the previous scheme is vulnerable to these attacks.

Hence, in this reserch, I aim to propose defense methods against the evasive techniques on different targets, GSI and BD, for the practical use of static detection based on CNN.

\begin{table}[h]
  \begin{center}
    \caption{Detection accuracy of original/manipulated malwares.}
    \label{tab:prev} 
    \begin{tabular}{|c|c|c|} \hline
       & Manipulation Target & Accuracy (\%) \\ \hline \hline
      Original Malware & no manipulation  & 99.8  \\ \hline
      AM & GSI & 66.1  \\ \hline 
      OM & BD & 86.2 \\ \hline
    \end{tabular}
  \end{center}
\end{table} 
%\afterpage{\clearpage}
%\newpage
\newpage
